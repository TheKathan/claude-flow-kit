{
  "agents": {
    "backend-developer": {
      "name": "python-developer",
      "type": "developer",
      "description": "Python backend developer for FastAPI applications",
      "scope": "backend",
      "watches": [
        "app/**/*.py",
        "src/**/*.py",
        "backend/**/*.py"
      ],
      "reviewer": "backend-reviewer",
      "capabilities": [
        "write_code",
        "fix_issues",
        "run_tests",
        "create_pr",
        "respond_to_reviews"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/python-developer.md"
    },
    "backend-reviewer": {
      "name": "backend-code-reviewer",
      "type": "reviewer",
      "description": "Backend code reviewer for security and best practices",
      "scope": "backend",
      "watches": [
        "app/**/*.py",
        "src/**/*.py",
        "backend/**/*.py"
      ],
      "reviews_for": "backend-developer",
      "capabilities": [
        "review_code",
        "post_comments",
        "approve_pr",
        "request_changes"
      ],
      "model": "sonnet",
      "review_criteria": [
        "security",
        "performance",
        "best_practices",
        "architecture",
        "error_handling",
        "type_safety"
      ],
      "agent_file": ".claude/agents/backend-code-reviewer.md"
    },
    "frontend-developer": {
      "name": "react-frontend-dev",
      "type": "developer",
      "description": "React/Next.js frontend developer with TypeScript",
      "scope": "frontend",
      "watches": [
        "dashboard/**/*.{ts,tsx,js,jsx,css}",
        "frontend/**/*.{ts,tsx,js,jsx,css}",
        "src/**/*.{ts,tsx,js,jsx,css}",
        "client/**/*.{ts,tsx,js,jsx,css}"
      ],
      "reviewer": "frontend-reviewer",
      "capabilities": [
        "write_code",
        "fix_issues",
        "create_pr",
        "respond_to_reviews"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/react-frontend-dev.md"
    },
    "frontend-reviewer": {
      "name": "frontend-code-reviewer",
      "type": "reviewer",
      "description": "Frontend code reviewer for React best practices and accessibility",
      "scope": "frontend",
      "watches": [
        "dashboard/**/*.{ts,tsx,js,jsx,css}",
        "frontend/**/*.{ts,tsx,js,jsx,css}",
        "src/**/*.{ts,tsx,js,jsx,css}",
        "client/**/*.{ts,tsx,js,jsx,css}"
      ],
      "reviews_for": "frontend-developer",
      "capabilities": [
        "review_code",
        "post_comments",
        "approve_pr",
        "request_changes"
      ],
      "model": "sonnet",
      "review_criteria": [
        "react_best_practices",
        "accessibility",
        "performance",
        "typescript",
        "ui_ux",
        "responsive_design"
      ],
      "agent_file": ".claude/agents/frontend-code-reviewer.md"
    },
    "architect": {
      "name": "software-architect",
      "type": "architect",
      "description": "Software architect for system design and preventing technical debt",
      "scope": "all",
      "watches": [
        "**/*.py",
        "**/*.ts",
        "**/*.tsx",
        "**/*.js",
        "**/*.jsx"
      ],
      "capabilities": [
        "design_architecture",
        "review_design",
        "prevent_tech_debt",
        "plan_features"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Grep",
        "Glob"
      ],
      "trigger_on": [
        "complex_feature",
        "new_service",
        "architectural_change",
        "major_refactoring"
      ],
      "agent_file": ".claude/agents/software-architect.md"
    },
    "python-tester": {
      "name": "python-test-specialist",
      "type": "tester",
      "description": "Python test specialist using pytest and mocking",
      "scope": "backend",
      "watches": [
        "app/**/*.py",
        "src/**/*.py",
        "backend/**/*.py"
      ],
      "capabilities": [
        "write_tests",
        "review_tests",
        "measure_coverage",
        "setup_fixtures"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/python-test-specialist.md"
    },
    "react-tester": {
      "name": "react-test-specialist",
      "type": "tester",
      "description": "React test specialist using React Testing Library and Jest",
      "scope": "frontend",
      "watches": [
        "dashboard/**/*.{ts,tsx,js,jsx}",
        "frontend/**/*.{ts,tsx,js,jsx}",
        "src/**/*.{ts,tsx,js,jsx}",
        "client/**/*.{ts,tsx,js,jsx}"
      ],
      "capabilities": [
        "write_component_tests",
        "write_integration_tests",
        "test_accessibility",
        "measure_coverage"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/react-test-specialist.md"
    },
    "e2e-tester": {
      "name": "integration-tester",
      "type": "tester",
      "description": "Execute tests and enforce quality gates",
      "scope": "all",
      "watches": [
        "**/*.py",
        "**/*.ts",
        "**/*.tsx",
        "scripts/test_*.py"
      ],
      "capabilities": [
        "run_integration_tests",
        "run_e2e_tests",
        "verify_apis",
        "test_security",
        "generate_reports"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/integration-tester.md"
    },
    "worktree-mgr": {
      "name": "worktree-manager",
      "type": "manager",
      "description": "Manage git worktrees with isolated Docker environments",
      "scope": "all",
      "watches": [
        ".worktrees/**/*.json",
        "scripts/worktree_*.sh",
        "scripts/worktree_*.py"
      ],
      "capabilities": [
        "create_worktree",
        "setup_docker",
        "merge_branch",
        "cleanup_resources"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/worktree-manager.md"
    },
    "docker-debug": {
      "name": "docker-debugger",
      "type": "debugger",
      "description": "Diagnose and fix Docker container issues",
      "scope": "all",
      "watches": [
        "docker-compose*.yml",
        "Dockerfile",
        ".env*"
      ],
      "capabilities": [
        "diagnose_docker",
        "fix_containers",
        "check_ports",
        "analyze_logs",
        "force_cleanup"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/docker-debugger.md"
    },
    "status-reviewer": {
      "name": "project-status-reviewer",
      "type": "reviewer",
      "description": "Assess project state, verify documentation accuracy, and ensure alignment between implementation and documentation",
      "scope": "all",
      "watches": [
        "docs/**/*.md",
        "CLAUDE.md",
        ".claude/**/*.md"
      ],
      "capabilities": [
        "review_docs",
        "check_status",
        "identify_gaps",
        "generate_report"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/project-status-reviewer.md"
    },
    "conflict-resolver": {
      "name": "merge-conflict-resolver",
      "type": "resolver",
      "description": "Detect and resolve git merge conflicts",
      "scope": "all",
      "watches": [
        "**/*.py",
        "**/*.ts",
        "**/*.tsx",
        "**/*.js",
        "**/*.jsx"
      ],
      "capabilities": [
        "detect_conflicts",
        "resolve_conflicts",
        "verify_resolution",
        "report_status"
      ],
      "model": "sonnet",
      "tools": [
        "Read",
        "Write",
        "Edit",
        "Bash",
        "Grep",
        "Glob"
      ],
      "agent_file": ".claude/agents/merge-conflict-resolver.md"
    }
  },
  "workflow": {
    "max_review_cycles": 3,
    "auto_merge_on_approval": false,
    "require_tests_pass": true,
    "require_architecture_review": false,
    "require_integration_tests_pass": true,
    "commit_before_review": true,
    "auto_push_on_approval": true,
    "worktree_based": true,
    "auto_cleanup_on_merge": true,
    "steps": [
      {
        "step": 0,
        "agent": "architect",
        "action": "design",
        "description": "Design architecture (optional - for complex features)",
        "optional": true,
        "skip_conditions": [
          "bug_fix",
          "typo_fix",
          "minor_tweak",
          "simple_feature"
        ],
        "trigger_keywords": [
          "new service",
          "new feature",
          "architectural",
          "refactor",
          "redesign",
          "complex"
        ]
      },
      {
        "step": 1,
        "agent": "worktree-manager",
        "action": "create_worktree",
        "description": "Create isolated worktree + Docker environment",
        "required": true,
        "outputs": {
          "worktree_path": "string",
          "branch_name": "string",
          "docker_ports": "object",
          "worktree_id": "number"
        },
        "on_failure": {
          "agent": "docker-debugger",
          "action": "diagnose_and_fix",
          "step": "1b"
        }
      },
      {
        "step": 2,
        "agent": "developer",
        "action": "implement",
        "description": "Implement feature in worktree",
        "context": "uses worktree from step 1"
      },
      {
        "step": 3,
        "agent": "test-specialist",
        "action": "write_tests",
        "description": "Write comprehensive tests in worktree",
        "agent_mapping": {
          "backend": "python-test-specialist",
          "frontend": "react-test-specialist"
        }
      },
      {
        "step": 4,
        "agent": "developer",
        "action": "commit",
        "description": "Commit production code + tests in worktree"
      },
      {
        "step": 5,
        "agent": "integration-tester",
        "action": "run_tests",
        "description": "Run unit tests in worktree Docker",
        "gate": "must_pass",
        "docker_context": "worktree_docker_project",
        "commands": {
          "backend": "docker-compose exec backend pytest --cov=app --cov-report=term-missing",
          "frontend": "docker-compose exec frontend npm test -- --coverage"
        },
        "pass_threshold": {
          "coverage": 80,
          "failures": 0
        },
        "on_docker_failure": {
          "agent": "docker-debugger",
          "action": "diagnose_and_fix",
          "step": "5b",
          "retry_after_fix": true
        }
      },
      {
        "step": 6,
        "agent": "reviewer",
        "action": "code_review",
        "description": "Review code quality, security, best practices",
        "gate": "must_approve"
      },
      {
        "step": 7,
        "agent": "developer",
        "action": "fix_if_needed",
        "description": "Fix issues if requested, then return to step 5 (re-test) \u2192 step 6 (re-review)"
      },
      {
        "step": 8,
        "agent": "integration-tester",
        "action": "integration_test",
        "description": "Run E2E tests in worktree Docker",
        "gate": "must_pass",
        "docker_context": "worktree_docker_project",
        "commands": {
          "backend": [
            "docker-compose exec backend python scripts/test_auth.py",
            "docker-compose exec backend python scripts/test_workspace.py",
            "docker-compose exec backend python scripts/test_{component}.py"
          ],
          "frontend": [
            "docker-compose exec frontend npm run test:e2e"
          ]
        },
        "on_docker_failure": {
          "agent": "docker-debugger",
          "action": "diagnose_and_fix",
          "step": "8b",
          "retry_after_fix": true
        }
      },
      {
        "step": 9,
        "agent": "developer",
        "action": "push",
        "description": "Push feature branch to remote"
      },
      {
        "step": 10,
        "agent": "merge-conflict-resolver",
        "action": "resolve_conflicts",
        "description": "Pull main, detect & resolve merge conflicts",
        "gate": "must_pass",
        "required": true
      },
      {
        "step": 11,
        "agent": "integration-tester",
        "action": "final_integration_test",
        "description": "Final integration test with main merged",
        "gate": "must_pass",
        "docker_context": "worktree_docker_project",
        "commands": {
          "backend": [
            "docker-compose exec backend pytest",
            "docker-compose exec backend python scripts/test_auth.py"
          ],
          "frontend": [
            "docker-compose exec frontend npm test"
          ]
        },
        "on_docker_failure": {
          "agent": "docker-debugger",
          "action": "diagnose_and_fix",
          "step": "11b",
          "retry_after_fix": true
        }
      },
      {
        "step": 12,
        "agent": "worktree-manager",
        "action": "merge_to_main",
        "description": "Merge to main and push",
        "required": true
      },
      {
        "step": 13,
        "agent": "worktree-manager",
        "action": "cleanup",
        "description": "Delete worktree, Docker containers, images, volumes",
        "required": true,
        "always_run": true,
        "on_failure": {
          "agent": "docker-debugger",
          "action": "force_cleanup",
          "step": "13b",
          "description": "Force cleanup stuck containers and volumes"
        }
      }
    ]
  },
  "workflow_variants": {
    "full": {
      "name": "Full Worktree Workflow (13 steps)",
      "description": "Complete workflow with worktree isolation, architecture review, testing, conflict resolution, and automated merge/cleanup",
      "use_for": [
        "new_feature",
        "major_change",
        "complex_feature",
        "new_service"
      ],
      "steps": [
        0,
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13
      ],
      "estimated_time": "35-50 minutes",
      "cost_estimate": "high",
      "when_to_use": "New features, architectural changes, major refactoring"
    },
    "standard": {
      "name": "Standard Worktree Workflow (11 steps)",
      "description": "Most common workflow - skips architecture review",
      "use_for": [
        "feature",
        "enhancement",
        "improvement"
      ],
      "steps": [
        1,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9,
        10,
        11,
        12,
        13
      ],
      "estimated_time": "25-35 minutes",
      "cost_estimate": "medium",
      "when_to_use": "Regular features and enhancements (most common)"
    },
    "hotfix": {
      "name": "Hotfix Worktree Workflow (9 steps)",
      "description": "Emergency fixes with worktree isolation - minimal gates, faster push",
      "use_for": [
        "bug_fix",
        "security_patch",
        "urgent_fix",
        "critical_bug"
      ],
      "steps": [
        1,
        2,
        4,
        5,
        6,
        9,
        10,
        12,
        13
      ],
      "estimated_time": "15-20 minutes",
      "cost_estimate": "low",
      "when_to_use": "Production bugs, security patches, urgent fixes",
      "notes": "Skips test writing (assumes tests exist), skips E2E tests for speed"
    },
    "test_only": {
      "name": "Test-Only Worktree Workflow (7 steps)",
      "description": "Add tests to existing code with worktree isolation",
      "use_for": [
        "add_tests",
        "improve_coverage",
        "test_refactor"
      ],
      "steps": [
        1,
        3,
        4,
        5,
        9,
        12,
        13
      ],
      "estimated_time": "15-20 minutes",
      "cost_estimate": "low",
      "when_to_use": "Improving test coverage for existing code"
    },
    "docs_only": {
      "name": "Documentation Worktree Workflow (6 steps)",
      "description": "Documentation-only changes with worktree isolation",
      "use_for": [
        "documentation",
        "readme",
        "comments",
        "docs_update"
      ],
      "steps": [
        1,
        2,
        9,
        10,
        12,
        13
      ],
      "estimated_time": "10-15 minutes",
      "cost_estimate": "very_low",
      "when_to_use": "README, docs, comments (no code changes)",
      "notes": "Skips all testing and review gates, but includes conflict resolution"
    },
    "legacy_direct": {
      "name": "Legacy Direct Branch Workflow (9 steps)",
      "description": "Original workflow without worktree isolation - for simple changes on main branch",
      "use_for": [
        "simple_fix",
        "minor_change",
        "no_isolation_needed"
      ],
      "steps": [
        0,
        2,
        3,
        4,
        5,
        6,
        7,
        8,
        9
      ],
      "estimated_time": "20-30 minutes",
      "cost_estimate": "medium",
      "when_to_use": "Simple changes that don't need worktree isolation",
      "notes": "Original 9-step workflow - use for backward compatibility only"
    }
  },
  "smart_fix_loop": {
    "enabled": true,
    "description": "Intelligently skip unnecessary steps based on what changed",
    "rules": [
      {
        "name": "comment_only_changes",
        "condition": "only_comments_or_docstrings_changed",
        "skip_steps": [
          4
        ],
        "reason": "Tests don't need to re-run for comment/docstring changes",
        "detection": "git diff shows only lines starting with # or triple quotes"
      },
      {
        "name": "test_only_changes",
        "condition": "only_test_files_changed",
        "skip_steps": [
          5
        ],
        "reason": "Code review not needed if only tests changed",
        "detection": "All changed files are in tests/ directory or match *test*.py or *.test.tsx"
      },
      {
        "name": "docs_only_changes",
        "condition": "only_documentation_changed",
        "skip_steps": [
          4,
          5,
          7
        ],
        "reason": "No testing or review needed for docs",
        "detection": "All changed files are *.md or in docs/ directory"
      },
      {
        "name": "low_severity_issues",
        "condition": "review_found_only_low_severity_issues",
        "optimize": "combine_test_and_review",
        "reason": "Minor issues don't need full re-test + re-review cycle",
        "detection": "Code review output contains only 'Low' severity issues"
      },
      {
        "name": "whitespace_only",
        "condition": "only_whitespace_changed",
        "skip_steps": [
          4,
          5,
          7
        ],
        "reason": "Formatting changes don't affect functionality",
        "detection": "git diff -w shows no changes"
      }
    ]
  },
  "gates": {
    "test_runner": {
      "min_coverage": 80,
      "allow_failures": 0,
      "blocking": true,
      "scope": "unit_tests_only",
      "fast_mode": true,
      "max_duration_seconds": 120
    },
    "integration_tester": {
      "allow_failures": 0,
      "timeout_seconds": 300,
      "blocking": true,
      "scope": "e2e_and_integration",
      "skip_if_unit_tests_failed": true
    },
    "code_reviewer": {
      "blocking": true,
      "approval_required": true,
      "auto_approve_if": [
        "only_comments_changed",
        "only_docs_changed",
        "only_whitespace_changed"
      ],
      "severity_threshold": "medium"
    }
  },
  "pr_settings": {
    "auto_create": true,
    "branch_prefix": {
      "backend": "backend/",
      "frontend": "frontend/"
    },
    "default_base": "main",
    "squash_merge": true
  },
  "paths": {
    "backend": [
      "app",
      "src",
      "backend",
      "api",
      "server"
    ],
    "frontend": [
      "dashboard",
      "frontend",
      "client",
      "web",
      "ui"
    ]
  }
}
